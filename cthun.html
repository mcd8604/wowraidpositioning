<html>
	<head>
		<style>
		body {
			background-color:	#333333;
			background-image:	url("CThun_Positioning.png");
			background-repeat:	no-repeat;
			background-size:	800px;
			background-position:150px 0px;
			font-family: "Arial";
			font-weight: bold;
		}
		</style>
		<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
		<script>

			var RAID_CLASS_COLORS = {
				"Druid"		:	"#FF7D0A",
				"Hunter"	:	"#ABD473",
				"Mage"		:	"#69CCF0",
				"Paladin"	:	"#F58CBA",
				"Priest"	:	"#FFFFFF",
				"Rogue"		:	"#FFF569",
				"Shaman"	:	"#0070DE",
				"Warlock"	:	"#9482C9",
				"Warrior"	:	"#C79C6E",
			}

			class Raider extends createjs.Container {
				constructor(raiderData) {
					super();
					this.x = raiderData.x
					this.y = raiderData.y
					var dot = new createjs.Shape()
					var classColor = RAID_CLASS_COLORS[raiderData.class]
					dot.graphics
						.beginFill(classColor)
						.beginStroke("#000000")
						.setStrokeStyle(2)
						.drawCircle(0, 0, 10)
					this.addChild(dot)
					var group = new createjs.Text(raiderData.group, "bold 12px Arial", 'Black');
					group.x = -3
					group.y = -4
					this.addChild(group)
					this.nameplate = new createjs.Container()
					//var background = new createjs.Shape();
					//background.graphics.beginFill("Grey").drawRect(0, 0, 100, 30);
					var name = new createjs.Text(raiderData.name, "bold 12px Arial", classColor);
					name.shadow = new createjs.Shadow("#000000", 2, 2, 3);
					name.x = 12
					name.y = -5
					//this.nameplate.addChild(background, name);
					this.nameplate.addChild(name);
					this.addChild(this.nameplate)
				}
			}

			// TODO externalize to cookie/datafile/userinput/etc
			var roster = [
				{ name:"Picklenick"	, class:"Warrior"	, group:1, x:0, y:0},
				{ name:"Lootahona"	, class:"Warrior"	, group:1, x:0, y:0},
				{ name:"Edbert"		, class:"Warrior"	, group:1, x:0, y:0},
				{ name:"Coldbolt"	, class:"Warlock"	, group:1, x:0, y:0},
				{ name:"Shadowfist"	, class:"Shaman"	, group:1, x:0, y:0},
				{ name:"Zengath"	, class:"Rogue"		, group:2, x:0, y:0},
				{ name:"Serbagz"	, class:"Warrior"	, group:2, x:0, y:0},
				{ name:"Bigballz"	, class:"Warrior"	, group:2, x:0, y:0},
				{ name:"Cutepie"	, class:"Hunter"	, group:2, x:0, y:0},
				{ name:"Splash"		, class:"Shaman"	, group:2, x:0, y:0},
				{ name:"Grisha"		, class:"Rogue"		, group:3, x:0, y:0},
				{ name:"Gachi"		, class:"Rogue"		, group:3, x:0, y:0},
				{ name:"Marc"		, class:"Warrior"	, group:3, x:0, y:0},
				{ name:"Amitola"	, class:"Hunter"	, group:3, x:0, y:0},
				{ name:"Sofresh"	, class:"Shaman"	, group:3, x:0, y:0},
				{ name:"Matuchin"	, class:"Rogue"		, group:4, x:0, y:0},
				{ name:"Brian"		, class:"Rogue"		, group:4, x:0, y:0},
				{ name:"Doddler"	, class:"Warrior"	, group:4, x:0, y:0},
				{ name:"Nuck"		, class:"Warrior"	, group:4, x:0, y:0},
				{ name:"Xanax"		, class:"Shaman"	, group:4, x:0, y:0},
				{ name:"Killchan"	, class:"Warrior"	, group:5, x:0, y:0},
				{ name:"Claire"		, class:"Warrior"	, group:5, x:0, y:0},
				{ name:"Scamaz"		, class:"Priest"	, group:5, x:0, y:0},
				{ name:"Unagi"		, class:"Priest"	, group:5, x:0, y:0},
				{ name:"Macha"		, class:"Shaman"	, group:5, x:0, y:0},
				{ name:"Hufian"		, class:"Druid"		, group:6, x:0, y:0},
				{ name:"Dregadruid"	, class:"Druid"		, group:6, x:0, y:0},
				{ name:"Todefy"		, class:"Druid"		, group:6, x:0, y:0},
				{ name:"Mipha"		, class:"Priest"	, group:6, x:0, y:0},
				{ name:"(shaman)"	, class:"Shaman"	, group:6, x:0, y:0},
				{ name:"Aurheim"	, class:"Mage"		, group:7, x:0, y:0},
				{ name:"Enderson"	, class:"Mage"		, group:7, x:0, y:0},
				{ name:"Maurty"		, class:"Mage"		, group:7, x:0, y:0},
				{ name:"Qty"		, class:"Mage"		, group:7, x:0, y:0},
				{ name:"Andruis"	, class:"Priest"	, group:7, x:0, y:0},
				{ name:"Raioh"		, class:"Warlock"	, group:8, x:0, y:0},
				{ name:"Acadalia"	, class:"Warlock"	, group:8, x:0, y:0},
				{ name:"Vireo"		, class:"Warlock"	, group:8, x:0, y:0},
				{ name:"(mage)"		, class:"Mage"		, group:8, x:0, y:0},
				{ name:"Borichu"	, class:"Priest"	, group:8, x:0, y:0},
			]

			var stage = null
			var raiderDisplays = []

			function init() {
				var canvas = document.getElementById('raidCanvas')
				stage = new createjs.Stage(canvas)
				loadRoster()
				updateNameplates(true)
			}

			function loadRoster() {
				var loadedRoster = JSON.parse(localStorage.getItem('roster'));
				if(loadedRoster) {
					roster = loadedRoster
				}
				createRaiderDisplays();
				if(!loadedRoster) {
					resetRaiderPositions()
				}
			}

			function resetRaiderPositions() {
				var xOffset = 20
				var yOffset = 20
				var ySpacing = 22
				for(i in raiderDisplays) {
					raiderDisplays[i].x = xOffset
					raiderDisplays[i].y = yOffset + (ySpacing * i)
				}
				stage.update();
			}

			function createRaiderDisplays() {
				for(i in roster) {
					var raider = new Raider(roster[i])
					raider.on("pressmove", function(evt) {
						evt.currentTarget.x = evt.stageX;
						evt.currentTarget.y = evt.stageY;
						stage.update();
					});
					raiderDisplays.push(raider);
					stage.addChild(raider);
				}
			}

			function updateNameplates(showNameplates) {
				for(i in raiderDisplays) {
					raiderDisplays[i].nameplate.visible = showNameplates
				}
				stage.update()
			}

			function save() {
				updateRosterPositions()
				localStorage.setItem('roster', JSON.stringify(roster));
			}

			function updateRosterPositions() {
				for(i in raiderDisplays) {
					roster[i].x = raiderDisplays[i].x
					roster[i].y = raiderDisplays[i].y
				}
			}

		</script>
	</head>
	<body onload="init();">
		<div>
			<label><input type='checkbox' id="showNames" onclick='updateNameplates(this.checked);' checked='true'>Show Names</label>
			<input type='button' id="save" onclick='save();' value="Save">
			<input type='button' id="reset" onclick='resetRaiderPositions();' value="Reset">
		</div>
		<img src=>
		<canvas id="raidCanvas" width="1000" height="1000"></canvas>
	</body>
</html>